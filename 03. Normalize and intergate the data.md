## SCtransform
```R
  library(future)
  options(future.globals.maxSize = 100 * 1024^3)  # 100 GB
 seurat_joined <- JoinLayers(seurat_obj)
 seurat_joined <- SCTransform(object = seurat_joined)
 seurat_joined <- RunPCA(seurat_joined, npcs = 30, verbose = F)
  
 seurat_joined <- FindNeighbors(seurat_joined, dims = 1:30,  k.param = 10)
 seurat_joined <- FindClusters(seurat_joined, resolution = 0.6)
  


```
## visualize umap before data integration
```R
  
seurat_joined <- RunUMAP(seurat_joined, dims = 1:30, reduction = "pca")
  
seurat_joined <- RunUMAP(seurat_joined, dims = 1:30, reduction = "umap")
  
  p1<- DimPlot(seurat_joined, reduction = 'umap', group.by = 'SCT_snn_res.0.6', label=T)
  p2<- DimPlot(seurat_joined, reduction = 'umap', group.by = 'Treatment', label=T)
  p3<- DimPlot(seurat_joined, reduction = 'umap', group.by = 'Sample', label=T)
  
```
## integrate the data
```R

  # Split
  seurat_list <- SplitObject(seurat_joined, split.by = "Sample")
  
  # Normalize
  seurat_list <- lapply(seurat_list, function(obj) {
    SCTransform(obj, verbose = T)
  })
  
  # 3. Select integration features from the list
  features <- SelectIntegrationFeatures(object.list = seurat_list, nfeatures = 3000)
  
  # 4. Prepare for integration
  seurat_list <- PrepSCTIntegration(object.list = seurat_list, anchor.features = features)
  
  # 5. Find integration anchors
  anchors <- FindIntegrationAnchors(object.list = seurat_list,
                                    normalization.method = "SCT",
                                    anchor.features = features)
  
  # 6. Integrate the data
  seurat_int<- IntegrateData(anchorset = anchors, normalization.method = "SCT")
  
  #umap
  seurat_int <- RunPCA(seurat_int, npcs = 30, verbose = F)
  
  seurat_int <- FindNeighbors(seurat_int, dims = 1:30,   k.param = 10)
  seurat_int <- FindClusters(seurat_int, resolution = 0.2)
  seurat_int <- RunUMAP(seurat_int, dims = 1:30, reduction = "pca")
  
  seurat_int <- RunUMAP(seurat_int, dims = 1:30, reduction = "umap")
  
  p1<- DimPlot(seurat_int, reduction = "umap", group.by = "integrated_snn_res.0.2", label = TRUE)
  
  p2<- DimPlot(seurat_int, reduction = "umap", group.by = "Sample", label = TRUE)
  
  p3<- DimPlot(seurat_int, reduction = "umap", group.by = "Treatment", label = TRUE)

  
```
