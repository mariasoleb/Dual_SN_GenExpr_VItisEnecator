## check reads mapped to E.necator and grapevine per sample
```R

library(dplyr)

# Aggregate per sample: mean %En reads
percent_En_per_sample <- seurat_obj2@meta.data %>%
  group_by(sample = Sample) %>%
  summarize(mean_percent_En = mean(percent.En, na.rm = TRUE))

sample_stats <- data.frame(
  sample = c("Sample1B", "Sample2A", "Sample3B", "Sample1", "Sample2", "Sample3", "Sample4", "Sample5", "Sample6", "Sample7", "Sample8", "Sample9", "Sample10", "Sample11", "Sample12"),
  treatment = c("Control", "Infected", "Infected", "Infected", "Infected", "Control",
                "Control", "Control", "Infected", "Control", "Infected", "Control", "Infected", "Control", "Infected"),
  dpi = c(1, 1, 5, 1, 1, 1, 5, 5, 5, 1, 1, 5, 5, 1, 5),
  total_mapped = c(94.42, 94.46, 90.12, 94.96, 93.06, 95.01, 95.86, 95.45,
                   94.19, 95.3, 95.11, 94.63, 83.01, 93.6, 82.74)
)

plot_data <- left_join(sample_stats, percent_En_per_sample, by = "sample") %>%
  mutate(
    percent_grape = total_mapped - mean_percent_En
  )


library(ggplot2)
library(tidyr)

# Step 1: Define Group
plot_data_long$Group <- factor(
  paste(plot_data_long$treatment, paste0(plot_data_long$dpi, "dpi"), sep = "_"),
  levels = c("Control_1dpi", "Infected_1dpi", "Control_5dpi", "Infected_5dpi")  # define desired order
)

# Step 2: Order samples within Group
plot_data_long <- plot_data_long[order(plot_data_long$Group, plot_data_long$sample), ]
plot_data_long$sample <- factor(plot_data_long$sample, levels = unique(plot_data_long$sample))

# Step 3: Plot
pdf("plots/PercentReadsMapped.pdf", width = 5, height = 5)

ggplot(plot_data_long, aes(x = sample, y = PercentMapped, fill = Species)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("E. necator" = "black", "Grapevine" = "lightgrey")) +
  coord_cartesian(ylim = c(75, 100)) +
  facet_wrap(~Group, scales = "free_x")+
  theme_classic(base_size = 14) +
  labs(
    x = "Sample (Grouped by Treatment and DPI)",
    y = "% Mapped Reads",
    fill = "Species",
    title = "% Reads Mapped to Grapevine vs. E. necator"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
```
